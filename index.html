<!DOCTYPE html>
<html>
<<<<<<< HEAD
<head>
	<meta charset="utf-8">
	<title>Blaspheme map 2013</title>
	<style>

	body {
		background: #CBE9E9 none;
		font-size:2em;
	}
	
	svg {
		width: 100%;
	}

	#carte{
		background: #CBE9E9 none;
	}

	.stroke {
		fill: none;
		stroke: #aaa;
		stroke-width: .2px;
	}

	.graticule {
		fill: none;
		stroke: #aaa;
		stroke-width: .2px;
	}

	.boundary {
		fill: none;
		stroke: #fff;
		stroke-width: .2px;
	}
	
	.noPenalty 				{ fill: #eee; }
	.blaspheme 				{ fill: #A39D4D; }
	.apostasie 				{ fill: #AF70A6; }
	.diffamation 			{ fill: #1EBCC3; }
	.blasphemeApostasie 	{ fill: #DC3D2F; }
	.apostasieDiffamation 	{ fill: #3F80DA; }
	.blasphemeDiffamation 	{ fill: #28A370; }
	.allPenalties 			{ fill: #15342E; }
	

	.legendeTexte {
		font-size: .6em;
		font-family: sans-serif;
		fill: #aaa;
	}
	
	.infosTitre {
		font-size: .8em;
		font-family: sans-serif;
		fill: #f00;
	}
	
	.infosTitreCat {
		fill: #555;	
	}
	
	.infosTexte {
		font-size: .6em;
		font-family: sans-serif;
		fill: #555;
	}
	
	.capitaleTexte {
		font-size: .5em;
		font-family: sans-serif;
		fill: #555;
	}

	.capitalePoint {
		fill: #555;	
	}

	</style>
	<script src="d3.js"></script>
	<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
	<script src="queue.v1.min.js"></script>
</head>	

<body>

<script>






var width = window.innerWidth, 
	height = window.innerHeight;

var projection = d3.geo
	//.azimuthalEqualArea()
	//.mercator()
	.kavrayskiy7()
	//.mollweide()
	//.peirceQuincuncial()
	//.conicEquidistant()
	//.orthographic()
	//.eisenlohr()
	.scale(100)
	.translate([width / 2, height / 2]);

var path = d3.geo.path().projection(projection);

var graticule = d3.geo.graticule();

var svg = d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height);


//création de la shpère de fond
svg.append("defs").append("path")
	.datum({type: "Sphere"})
	.attr("id", "sphere")
	.attr("d", path)
	.style("fill", "#CBE9E9");

svg.append("use")
	.attr("class", "stroke")
	.attr("xlink:href", "#sphere");

svg.append("use")
	.attr("class", "fill")
	.attr("xlink:href", "#sphere");

svg.append("path")
	.datum(graticule)
	.attr("class", "graticule")
	.attr("d", path);






var infosPays = [];
var carte = svg.append("svg:g").attr("id", "carte");
var capitalePoint;
var capitaleTexte;
var pictoPath;
var isZoomed = false;
var categories;


// INTERACTION
var infos = svg.append("svg:g").attr("id", "infos");
var infosFond = infos.append("svg:rect").attr("id", "infosFond").style("fill", "#eee");
var infosTitre = [2];
infosTitre[0] = infos.append("svg:text").attr("class", "infosTitre");
infosTitre[1] = infos.append("svg:text").attr("class", "infosTitre infosTitreCat");
var nbCat = 9;
var infosTexte = [nbCat];
for(var i = 0; i < nbCat; i++){
	infosTexte[i] = infos.append("svg:text").attr("class", "infosTexte");
}
var infosValeurs = [3]; infosValeurs[0] = []; infosValeurs[1] = []; infosValeurs[2] = [];
var paysClique;
var cow = ""; var isInformed;
var pie = d3.layout.pie().sort(null).value(function(d) { return d; });    
var arc = d3.svg.arc().outerRadius(20).innerRadius(60);
var donut = infos.selectAll(".arc");
var legendeReligionsCarres = [nbCat];
var legendeReligionsTextes = [nbCat];


		








	
queue()
	.defer(d3.csv, 	"blasphemeInfos.csv", 		function(d, i){ traiterInfosBlaspheme(d, i); })
	.defer(d3.csv, 	"pictoMort.csv", 			function(d){ traiterPictos(d)})
	.defer(d3.json,	"world-countries.json", 	function(d){ dessinerCarte(d); })
	.awaitAll(ready());




function traiterInfosBlaspheme(d, i) {

	var categories = [ d.blasphème, d.apostasie, d.diffamation ];
	
	var nomClasse = "";
	categories.forEach(function(d, j){  	
		if(d == "oui"){ 
			nomClasse += "O";
		} else {
			nomClasse += "N";	
		}
	});	

	switch (nomClasse) {
		case "NNN": 
			nomClasse = "noPenalty";
			break;
		case "ONN": 
			nomClasse = "blaspheme";
			break;
		case "NON": 
			nomClasse = "apostasie";
			break;
		case "NNO": 
			nomClasse = "diffamation";
			break;
		case "OON": 
			nomClasse = "blasphemeApostasie";
			break;
		case "NOO": 
			nomClasse = "apostasieDiffamation";
			break;
		case "ONO": 
			nomClasse = "blasphemeDiffamation";
			break;
		case "OOO": 
			nomClasse = "allPenalties";
			break;
	}
	
	var mort = false;
	if(d.mort == "oui"){ mort = true; }





	infosPays.push([ d.iso, nomClasse, mort ]);
	
} 




function traiterPictos(data)
{
	pictoPath = data.path;
}





function dessinerCarte(collection)
{
	
	// CARTE
	carte.selectAll("path")
		.data(collection.features)
		.enter().append("svg:path")
		.attr("d", path)
		.attr("id", function(d){ return d.id; })
		.attr("title", function(d){ return d.properties.name; })
		.attr("name", "pays")
		.attr("class", function(d){
			
			var classe = ""; 
			infosPays.forEach(function(e, i){
				if(infosPays[i][0] == d.id)
				{
					classe = infosPays[i][1];
				}
			});
			return "boundary "+classe;
		})
		.on("mouseover", function(d){ over(d); })
		.on("mouseout", function(d){ out(d); })
		.on("click", function(d){ click(d); });
		
	


	
	// PICTOS
	collection.features.forEach(function(data) {
		var centroid = path.centroid(data);
		carte.append("svg:g")
			.attr("transform", "translate("+centroid[0]+", "+centroid[1]+") scale(0.4)")
			.append("svg:path")
				.attr("d", function(d){
					
					var forme = "";
					infosPays.forEach(function(e, i){
						if(infosPays[i][0] == data.id)
						{
							if(infosPays[i][2])
							{
								forme = pictoPath;
							}
						}
					});
					return forme;
				})
				.style("fill", "#fff");	
	});
	


	// LEGENDE
	var x = 10;
	var y = 14;
	var legende = svg.append("svg:g").attr("class", "legende");
	legende.append("svg:text").attr("class", "infosTitre")
			.attr("x", x).attr("y", y)
			.text("Penalisation par la loi");
	y += 20;
			
	categories = [ [ "NNN", "aucune"], 
					[ "ONN", "blasphème" ], 
					[ "NON", "apostasie" ], 
					[ "NNO", "diffamation" ], 
					[ "OON", "blasphème + apostasie" ], 
					[ "NOO", "apostasie + diffamation" ], 
					[ "ONO", "blasphème + diffamation"], 
					[ "OOO", "la totale"] ];
	
	categories.forEach(function(d){
		legende.append("svg:rect")
			.attr("width", "10").attr("height", "10")
			.attr("x", x).attr("y", y)
			.attr("class", d[0]);
		legende.append("svg:text").attr("class", "legendeTexte")
			.attr("x", x+20).attr("y", y+10)
			.text(d[1]);
			
		y += 30;
	});
	
	y += 5;
	
	// picto mort en derniere ligne
	legende.append("svg:path")
		.attr("transform", "translate("+(x+5)+", "+(y-3)+") scale(1)")
		.attr("d", pictoPath)
		.style("fill", "#000");
	
	legende.append("svg:text").attr("class", "legendeTexte")
		.attr("x", x+20).attr("y", y)
		.text("puni de mort");			
}




function ready()
{
	var hash = window.location.hash;	
	if(hash != "#" && hash != "" && hash != "general")
	{
		d3.json("world-countries.json", function(collection){ 
			
			collection.features.forEach(function(d){
				if(hash == "#"+d.id){ click(d); isZoomed = !isZoomed; }	
			});
		});
	}
}


















/////////////////////////////////////
// INTERACTION /////////////////////
///////////////////////////////////


function over(d)
{
	if(!isZoomed)
	{
		var cible = this.svg.select("#"+d.id);
		cible.transition()
			.duration(100)
	}
}


function out(d)
{
	if(!isZoomed)
	{
=======
	<head>
		<meta charset="utf-8">
		<title>Blaspheme map 2013</title>
>>>>>>> d1f87d2148aa6048febcef1653ea0f095342d065
		
		<link rel="stylesheet" type="text/css" href="style.css" >
		
		<script type="text/javascript" src="d3.js"></script>
		<script type="text/javascript" src="d3geo.js"></script>
		<script type="text/javascript" src="queue.js"></script>
		<script type="text/javascript" src="main.js"></script>
	</head>	

	<body>
	
		<svg id="svg"></svg>
		
		<div id="sources" style="color: #fff; text-align: left; padding: 1em; font-family: sans-serif; font-size: 0.6em;">
		<p>sources<br/>Pew Research, Religion and Public Life Project, 21 novembre 2012<a href="http://www.pewforum.org/2012/11/21/laws-penalizing-blasphemy-apostasy-and-defamation-of-religion-are-widespread/"></a><br/>Zeev Maoz and Errol A. Henderson. “The World Religion Dataset, 1945-2010: Logic, Estimates, and trends.” International Interactions, 39(3) <a href="http://www.correlatesofwar.org/COW2%20Data/Religion/Religion.htm">source</a><br/>
		powered by <a href="http://d3js.org/">D3.js</a> de  Mike Bostock</p>
		</div>
	</body>

</html>





