<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Blaspheme map 2013</title>
	<style>

	body {
		background: #fff;
	}
	
	svg {
		background: #fff;
	}

	.stroke {
		fill: none;
		stroke: #aaa;
		stroke-width: .2px;
	}

	.fill {
		fill: #fff;
	}

	.graticule {
		fill: none;
		stroke: #aaa;
		stroke-width: .2px;
	}

	.boundary {
		fill: none;
		stroke: #fff;
		stroke-width: .2px;
	}

	.legendeTexte {
		font-size: .6em;
		font-family: sans-serif;
		fill: #aaa;
	}

	</style>
	<script src="d3.js"></script>
	<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
	<script src="queue.v1.min.js"></script>
</head>	

<body>

<script>


var width = window.innerWidth-100, 
	height = window.innerHeight;

var projection = d3.geo
	//.azimuthalEqualArea()
	.mercator()
	//.kavrayskiy7()
	//.mollweide()
	//.peirceQuincuncial()
	//.conicEquidistant()
	//.orthographic()
	//.eisenlohr()
	.scale(100)
	.translate([(width / 2)+100, height / 2]);

var path = d3.geo.path().projection(projection);

var graticule = d3.geo.graticule();

var svg = d3.select("body").append("svg")
	.attr("width", width+100)
	.attr("height", height);



/*/création de la shpère de fond
svg.append("defs").append("path")
	.datum({type: "Sphere"})
	.attr("id", "sphere")
	.attr("d", path)
	.style("fill", "#fff");

svg.append("use")
	.attr("class", "stroke")
	.attr("xlink:href", "#sphere");

svg.append("use")
	.attr("class", "fill")
	.attr("xlink:href", "#sphere");

svg.append("path")
	.datum(graticule)
	.attr("class", "graticule")
	.attr("d", path);
//*/




var carte = svg.append("svg:g");
var isZoomed = false;



	
queue()
	.defer(d3.csv, 	"blasphemeInfos.csv", 		function(d, i){ traiterInfos(d, i); })
	.defer(d3.json,	"world-countries.json", 	function(d){ dessinerCarte(d); })
	.awaitAll(ready());




function traiterInfos(d, i) {

		 
	alert(d);	



} 










function zoom(d)
{ 
	var centroid = path.centroid(d);
	var scale = 0;
	if(!isZoomed)
	{
		scale = 2;
	} else {
		scale = 1;	
	}
	isZoomed = !isZoomed;
	carte.transition()
      		.duration(750)
      		.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + scale + ")translate(" + -centroid[0] + "," + -centroid[1] + ")");
}


function dessinerCarte(collection)
{
	
	// dessin de la carte
	carte.selectAll("path")
		.data(collection.features)
		.enter().append("svg:path")
		.attr("d", path)
		.attr("class", "boundary")
		.attr("id", function(d){ return d.id; })
		.attr("title", function(d){ return d.properties.name; })
		.style("fill", "#000")
		.on("click", function(d, i){ zoom(d, i); });
		
	

	
	/* dessin du picto au niveau du centroid du pays
	collection.features.forEach(function(d) {
		centroid = path.centroid(d);
		carte.append("svg:g")
			.attr("transform", "translate("+centroid[0]+", "+centroid[1]+") scale(2)")
			.append("svg:path")
				.attr("d", pictoPath[0])
				.style("fill", "#fff");
		
	});
	//*/

	

	
	/*/ legende	
	var x = 10;
	var y = 0;
	var legende = svg.append("svg:g").attr("class", "legende");
	function dessinerLegende(d, x)
	{
		legende.append("svg:rect")
			.attr("width", "10").attr("height", "10")
			.attr("x", x).attr("y", y)
			.style("fill", d[2]);
		legende.append("svg:text").attr("class", "legendeTexte")
			.attr("x", x+20).attr("y", y+10)
			.text(d[1]);
			
		y += 30;
	}

	selection.forEach(function(data){
		if(data.length > 3)
		{
			legende.append("svg:text").attr("class", "legendeTexte")
				.attr("x", x).attr("y", y+10)
				.text(data[1]);
			y += 20;
			data[3].forEach(function(d){ dessinerLegende(d, x+10); });
		} else {
			dessinerLegende(data, x);
		}
	});
	//*/
		
}


function ready()
{
	
}


</script>
</body>
</html>



